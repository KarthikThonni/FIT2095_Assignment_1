<!DOCTYPE html>
<%- include("partials/header", { title: "Edit Recipe", studentId }) %>

<div class="container my-4">
  <h1 class="mb-3">Edit Recipe</h1>

  <% if (error) { %><div class="alert alert-danger"><%= error %></div><% } %>

  <form method="POST" action="/api/edit-recipe-<%= studentId %>" class="row g-3">
    <input type="hidden" name="recipeId" value="<%= recipe.recipeId %>">

    <div class="col-md-6">
      <label class="form-label">Title</label>
      <input name="title" class="form-control" value="<%= recipe.title %>" required minlength="3" maxlength="100">
    </div>

    <div class="col-md-6">
      <label class="form-label">Chef</label>
      <input class="form-control" value="<%= user?.fullname %>" readonly>
      <div class="form-text">User ID: <code><%= user?.userId %></code></div>
      <input type="hidden" name="chef" value="<%= user?.fullname %>">
    </div>

    <div class="col-md-4">
      <label class="form-label">Meal Type</label>
      <select name="mealType" class="form-select" required>
        <% mealTypes.forEach(m => { %>
          <option value="<%= m %>" <%= recipe.mealType===m?'selected':'' %>><%= m %></option>
        <% }) %>
      </select>
    </div>

    <div class="col-md-4">
      <label class="form-label">Cuisine Type</label>
      <select name="cuisineType" class="form-select" required>
        <% cuisines.forEach(c => { %>
          <option value="<%= c %>" <%= recipe.cuisineType===c?'selected':'' %>><%= c %></option>
        <% }) %>
      </select>
    </div>

    <div class="col-md-4">
      <label class="form-label">Prep Time (mins)</label>
      <input name="prepTime" type="number" min="1" max="480" class="form-control" value="<%= recipe.prepTime %>" required>
    </div>

    <div class="col-md-4">
      <label class="form-label">Difficulty</label>
      <select name="difficulty" class="form-select" required>
        <% difficulties.forEach(d => { %>
          <option value="<%= d %>" <%= recipe.difficulty===d?'selected':'' %>><%= d %></option>
        <% }) %>
      </select>
    </div>

    <div class="col-md-4">
      <label class="form-label">Servings</label>
      <input name="servings" type="number" min="1" max="20" class="form-control" value="<%= recipe.servings %>" required>
    </div>

    <div class="col-12">
      <label class="form-label">Ingredients (one per line)</label>
      <textarea name="ingredients" class="form-control" rows="5" required><%= (recipe.ingredients || []).join("\n") %></textarea>
    </div>

    <div class="col-12">
      <label class="form-label">Instructions (one step per line)</label>
      <textarea name="instructions" class="form-control" rows="5" required><%= (recipe.instructions || []).join("\n") %></textarea>
    </div>

    <div class="col-md-4">
      <label class="form-label">Created Date (YYYY-MM-DD)</label>
      <input name="createdDate" class="form-control" value="<%= recipe.createdDate %>" required>
    </div>

    <div class="col-12">
      <button class="btn btn-primary">Save Changes</button>
      <a href="/recipes-<%= studentId %>" class="btn btn-secondary">Cancel</a>
    </div>
  </form>
</div>

<%- include("partials/footer") %>
