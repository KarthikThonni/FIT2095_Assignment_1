<!DOCTYPE html>
<%- include("partials/header", { title: "Scale Recipe", studentId }) %>

  <div class="container my-4">
    <h1 class="mb-3"> Scale Recipe Servings</h1>

    <% const _noRecipes = (typeof noRecipes !== 'undefined') ? noRecipes : !(Array.isArray(allRecipes) && allRecipes.length); %>

    <% if (_noRecipes) { %>
      <div class="alert alert-warning">
        You don't have any recipes yet.
        <a href="/add-recipe-<%= studentId %>" class="alert-link">Add your first recipe</a>
        to use the scaling tool.
      </div>
    <% } else { %>
      <form method="GET" action="/scale-recipe-<%= studentId %>" class="row g-3 mb-4">
        <div class="col-md-5">
          <label class="form-label">Select Recipe</label>
          <select name="recipeId" class="form-select" onchange="this.form.submit()">
            <% (allRecipes || []).forEach(r => { %>
              <option value="<%= r.recipeId %>" <%= (selected && r.recipeId===selected.recipeId) ? 'selected' : '' %>>
                <%= r.title %> (serves <%= r.servings %>)
              </option>
            <% }) %>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">New Servings</label>
          <input type="number" min="1" class="form-control" name="newServings" value="<%= (typeof newServings !== 'undefined' ? newServings : (selected ? selected.servings*2 : 2)) %>">
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button class="btn btn-success w-100">Scale</button>
        </div>
      </form>

      <% if (selected) { %>
        <div class="card">
          <div class="card-body">
            <h4 class="card-title"><%= selected.title %> â†’ <%= newServings %> servings</h4>

            <% if (!scaledIngredients || scaledIngredients.length === 0) { %>
              <p class="text-muted mb-0">No ingredients found to scale.</p>
            <% } else { %>
              <ul class="mb-0">
                <% scaledIngredients.forEach(line => { %>
                  <li><%= line %></li>
                <% }) %>
              </ul>
            <% } %>
          </div>
        </div>
      <% } %>
    <% } %>
  </div>
<%- include("partials/footer") %>

